---
phase: 04-merch-and-polish
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/lib/utils/animations.ts
  - src/lib/components/FlavorCard.svelte
  - src/lib/components/MegaSpiceCard.svelte
  - src/routes/+page.svelte
  - src/routes/products/+page.svelte
  - src/routes/about/+page.svelte
  - src/routes/blog/+page.svelte
  - src/lib/components/Nav.svelte
  - src/lib/components/MobileDrawer.svelte
  - tailwind.config.js
autonomous: false

must_haves:
  truths:
    - "Site builds successfully in production mode"
    - "Reduced motion preference is respected: all hover transitions, scroll animations, and entrance effects use motion-safe/motion-reduce modifiers"
    - "All CSS animations use only transform and opacity for 60fps GPU-accelerated performance"
    - "Lighthouse Performance score is 90+ when tested in preview mode"
    - "No layout shift from animated elements (CLS < 0.1)"
  artifacts:
    - path: "src/lib/utils/animations.ts"
      provides: "Updated animation utilities with reactive reduced motion store"
      exports: ["prefersReducedMotion", "bouncySpring", "SPRING_CONFIGS"]
    - path: "tailwind.config.js"
      provides: "Animation keyframes using only transform/opacity"
  key_links:
    - from: "all components with animations"
      to: "prefers-reduced-motion media query"
      via: "motion-safe: / motion-reduce: Tailwind modifiers or prefersReducedMotion() checks"
      pattern: "motion-safe:|motion-reduce:|prefersReducedMotion"
---

<objective>
Audit and optimize all animations for accessibility and performance. Ensure every animation across the site respects prefers-reduced-motion, only animates GPU-friendly properties (transform, opacity), and achieves Lighthouse Performance 90+ in production build.

Purpose: Satisfy criteria 3 (Lighthouse 90+), 4 (reduced motion respected), and 5 (smooth mobile animations). The site already has many animations but the reduced motion handling is inconsistent -- some components use the `prefersReducedMotion()` function, others don't. Hover transitions on cards and nav links lack motion-safe modifiers. The Tailwind keyframe animations (flame-flicker, heat-shimmer) run even with reduced motion enabled.
Output: Fully accessible, performance-optimized site passing Lighthouse 90+ audit.
</objective>

<execution_context>
@C:\Users\Mark\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mark\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-merch-and-polish/04-RESEARCH.md

@src/lib/utils/animations.ts
@src/lib/actions/inview.ts
@src/lib/actions/cheese-stretch.ts
@src/lib/components/FlavorCard.svelte
@src/lib/components/MegaSpiceCard.svelte
@src/lib/components/Nav.svelte
@src/routes/+page.svelte
@src/routes/+layout.svelte
@tailwind.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix all animations for accessibility and performance</name>
  <files>src/lib/utils/animations.ts, src/lib/components/FlavorCard.svelte, src/lib/components/MegaSpiceCard.svelte, src/routes/+page.svelte, src/routes/products/+page.svelte, src/routes/about/+page.svelte, src/routes/blog/+page.svelte, src/lib/components/Nav.svelte, src/lib/components/MobileDrawer.svelte, tailwind.config.js</files>
  <action>
This is a systematic audit-and-fix pass across the site. Work through each area:

**1. Tailwind config keyframe animations (`tailwind.config.js`):**
- Wrap flameFlicker, heatShimmer, cheeseDrip, wobbleIn animations in `@media (prefers-reduced-motion: no-preference)` via Tailwind's built-in approach: NO change needed to keyframes themselves, but all USAGES of these animations must use the `motion-safe:` prefix. Check all components that use `animate-flame-flicker`, `animate-heat-shimmer`, `animate-cheese-drip`, or `animate-wobble-in` and add `motion-safe:` prefix.
- EXCEPTION per user decision: MEGA SPICE flames should ALWAYS show (even with reduced motion). Keep flame-flicker on MegaSpiceCard without motion-safe prefix.

**2. Hover transitions on all interactive elements:**
Search all .svelte files for `hover:` combined with `transition-` and ensure they also have `motion-reduce:transition-none`. Key files:
- FlavorCard.svelte: hover shadow transitions
- Nav.svelte: `group-hover:scale-x-100 transition-transform` on underline, `group-hover:scale-110 transition-transform` on logo emoji -- add `motion-reduce:transition-none`
- Footer.svelte: `hover:text-nacho-600 transition-colors` (now in SocialLinks, should already be handled by Plan 01)
- Homepage (+page.svelte): `hover:shadow-2xl transition-shadow` on feature cards -- add `motion-reduce:transition-none`
- Blog listing (+page.svelte): any hover transitions -- add `motion-reduce:transition-none`

**3. CSS `transition-all` usage:**
Search for `transition-all` which is overly broad and can animate layout properties. Replace with specific properties:
- `transition-all hover:-translate-y-1` should become `transition-[transform,box-shadow] hover:-translate-y-1` or just use `transition-transform`
- Check the existing merch page cards (now ProductCard from Plan 01) and any other components

**4. Homepage decorative bouncing emojis (`+page.svelte`):**
The decorative cheese emojis use `animate-bounce` (Tailwind built-in). Add `motion-safe:` prefix: `motion-safe:animate-bounce`.

**5. Verify existing prefersReducedMotion usage:**
The homepage, FlavorCard, and other components already call `prefersReducedMotion()` and pass `{ hard: true }` for spring animations when reduced motion is on. This is CORRECT -- leave these patterns as-is. Just verify they work (the function reads `window.matchMedia`).

**6. Ensure no layout-triggering animations:**
Check that no animation uses `width`, `height`, `top`, `left`, `margin`, or `padding` in transitions. All should use `transform` and `opacity` only. The current keyframes already do this (they use transform and opacity) -- verify and fix any outliers.

**7. Add meta viewport if missing:**
Check `src/app.html` for `<meta name="viewport" content="width=device-width, initial-scale=1">`. If missing, add it (important for Lighthouse mobile audit).

Do NOT add `will-change` anywhere -- per research, browser optimizes well enough and overuse degrades performance.
  </action>
  <verify>
Run `bun run build` -- build succeeds. Run `bunx svelte-check --tsconfig ./tsconfig.json` -- no type errors.

Grep verification:
- `grep -r "transition-all" src/` should return 0 results (all replaced with specific properties)
- `grep -r "animate-bounce" src/` should show `motion-safe:animate-bounce` (not bare `animate-bounce`)
- `grep -rn "motion-safe\|motion-reduce" src/` should show results in all component files with animations
  </verify>
  <done>
Every animation in the site uses motion-safe/motion-reduce modifiers (except MEGA SPICE flames per user decision). No transition-all usage remains. All animated properties are GPU-friendly (transform, opacity). Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Production build and Lighthouse performance verification</name>
  <files></files>
  <action>
Run a production build and preview, then verify Lighthouse readiness:

1. Run `bun run build` to create production build
2. Run `bun run preview` to start preview server
3. Check the build output for:
   - Bundle size (should be small -- Svelte 5 produces compact bundles)
   - Any warnings about large chunks
   - SSR working correctly (no client-only code in server renders)

4. Manual Lighthouse readiness checklist (verify in code, do not run Lighthouse -- that requires browser):
   - All images have explicit width/height or aspect-ratio (check any `<img>` tags)
   - No render-blocking resources (fonts loaded with font-display: swap -- check app.css or app.html)
   - Meta viewport tag present
   - Semantic HTML used (nav, main, footer, article, h1-h6 hierarchy)
   - Color contrast passes (nacho-600 on white backgrounds is sufficient contrast)
   - All links have accessible names (aria-label or visible text)
   - No `console.log` statements left in production code

5. If build reveals any issues, fix them. Common SvelteKit optimizations:
   - Ensure `+layout.ts` has `export const prerender = true` if all pages are static (check if this is already set)
   - Check that `adapter-auto` or `adapter-node` is configured in `svelte.config.js`

Do NOT install any new packages. Do NOT add image optimization at this stage (no real images exist -- all placeholders are emoji/gradients). The enhanced-img optimization will matter when real product photos are added.
  </action>
  <verify>
`bun run build` completes with 0 errors and 0 warnings. Build output shows reasonable chunk sizes (< 200KB total JS). `bun run preview` starts successfully.
  </verify>
  <done>
Production build succeeds with no errors/warnings. Bundle sizes are reasonable. All Lighthouse-affecting code patterns are correct (semantic HTML, accessible labels, no render-blocking resources, GPU-only animations).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 4: Merch showcase with category filtering, social links (Instagram, TikTok, YouTube, X) in footer, and full accessibility/performance audit across all animations.
  </what-built>
  <how-to-verify>
1. Start preview server: `bun run build && bun run preview`
2. Visit the Merch page (/merch):
   - Verify all 5 category filter buttons appear (All, Apparel, Skate Decks, Stickers, Pins, Accessories)
   - Click each category -- products filter correctly
   - Cards have scroll-triggered entrance animations
   - "Coming Soon" badges visible on all products
   - Merch Drops banner and philosophy section still present
3. Scroll to footer on any page:
   - Verify 4 social icons: Instagram, TikTok, YouTube, X
   - Hover each icon -- color changes to nacho orange
   - Click one -- opens placeholder URL in new tab
4. Test reduced motion:
   - In Chrome DevTools > Rendering > "Emulate CSS media feature prefers-reduced-motion" > Set to "reduce"
   - Reload homepage -- hero should appear instantly (no bounce/fly animations)
   - Scroll down -- cards appear without slide-up animation
   - Hover cards -- no scale/translate transitions
   - Visit /products -- MEGA SPICE flames SHOULD still animate (exception)
5. Run Lighthouse in Chrome DevTools (Performance, Accessibility, Best Practices):
   - Target: Performance 90+, Accessibility 90+
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `bun run build` succeeds with no errors
2. `bunx svelte-check` passes with no type errors
3. No `transition-all` usage in codebase
4. All animation classes use motion-safe/motion-reduce (except MEGA SPICE flames)
5. Footer renders 4 social platform icons with accessibility
6. Merch page has category filtering across 5 categories
7. Lighthouse Performance audit targets 90+ in preview mode
</verification>

<success_criteria>
- Every animation respects prefers-reduced-motion (except MEGA SPICE flames per user decision)
- No transition-all remaining in codebase
- All animated properties are transform/opacity only (GPU-accelerated)
- Production build succeeds with small bundle sizes
- Human verifies Lighthouse 90+ in preview mode
- Human confirms merch filtering and social links work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/04-merch-and-polish/04-02-SUMMARY.md`
</output>
