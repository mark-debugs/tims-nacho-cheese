---
phase: 03-brand-and-content
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/data/quiz.ts
  - src/lib/components/Quiz.svelte
  - src/routes/quiz/+page.svelte
autonomous: true

must_haves:
  truths:
    - "User can take a personality quiz that asks fun questions about their preferences"
    - "Quiz matches user to one of the 5 cheese flavors based on their answers"
    - "Result page shows the matched flavor with personality description and link to products"
    - "Quiz has smooth transitions between questions"
  artifacts:
    - path: "src/lib/data/quiz.ts"
      provides: "Quiz questions, answer options with flavor score mappings, and result descriptions"
      exports: ["questions", "quizResults", "Question", "QuizResult"]
    - path: "src/lib/components/Quiz.svelte"
      provides: "Interactive quiz component with question display, answer selection, and result screen"
      min_lines: 80
    - path: "src/routes/quiz/+page.svelte"
      provides: "Quiz page composing Quiz component with brand-styled wrapper"
      min_lines: 15
  key_links:
    - from: "src/lib/components/Quiz.svelte"
      to: "src/lib/data/quiz.ts"
      via: "import questions and quizResults"
      pattern: "import.*quiz"
    - from: "src/lib/components/Quiz.svelte"
      to: "src/lib/data/flavors.ts"
      via: "import flavors for result display"
      pattern: "import.*flavors"
    - from: "src/lib/components/Quiz.svelte"
      to: "$lib/utils/animations"
      via: "import spring animations for question transitions"
      pattern: "import.*animations"
    - from: "src/routes/quiz/+page.svelte"
      to: "src/lib/components/Quiz.svelte"
      via: "renders Quiz component"
      pattern: "import.*Quiz"
---

<objective>
Build the interactive flavor finder quiz that matches users to their ideal Tim's cheese based on personality and preferences (BRAND-02). A fun, animated experience using Svelte 5 runes for state management and existing spring animations for smooth transitions.

Purpose: The quiz is a key engagement feature -- it's fun, shareable, and connects visitors to the product lineup in a playful way that fits Tim's brand.
Output: Complete quiz feature with questions, scoring, animated transitions, and flavor result.
</objective>

<execution_context>
@C:\Users\Mark\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mark\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-brand-and-content/03-RESEARCH.md

Key existing files to understand:
@src/lib/data/flavors.ts (Flavor type and all 5 products -- quiz results map to these)
@src/lib/utils/animations.ts (bouncySpring, prefersReducedMotion)
@src/lib/actions/inview.ts (scroll-triggered animations)
@src/lib/actions/cheese-stretch.ts (elastic hover)
@src/routes/+layout.svelte (layout structure, page transitions already working)
@src/lib/components/Nav.svelte (navigation links -- quiz route needs adding here)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create quiz data model with questions and scoring logic</name>
  <files>src/lib/data/quiz.ts</files>
  <action>
Create `src/lib/data/quiz.ts` with:

**Types:**
```typescript
export type Answer = {
  text: string;
  scores: Record<string, number>; // flavor id -> score points
};

export type Question = {
  id: number;
  question: string;
  emoji: string;
  answers: Answer[];
};

export type QuizResult = {
  flavorId: string;
  title: string;
  description: string;
  emoji: string;
  vibe: string; // one-liner vibe description
};
```

**Questions (7 questions, each with 4 answers):**
Design questions that feel like Tim's brand -- fun, west coast, personality-driven. NOT boring product questions.

1. "What's your ideal Saturday morning?" (emoji: sun)
   - "Dawn patrol surfing" -> mozz-pure +2, white-cheese +1
   - "Sleeping in, then brunch" -> white-cheese +2, cheddar-beddar +1
   - "Skating the empty park" -> cheddar-beddar +2, orange-spice +1
   - "Hot yoga then a habanero smoothie" -> mega-spice +2, orange-spice +1

2. "Pick your road trip soundtrack" (emoji: music)
   - "Chill lo-fi beats" -> white-cheese +2, mozz-pure +1
   - "Classic punk rock" -> cheddar-beddar +2, mega-spice +1
   - "Reggae and good vibes" -> orange-spice +2, mozz-pure +1
   - "Death metal at max volume" -> mega-spice +2, cheddar-beddar +1

3. "Your dream vacation is..." (emoji: airplane)
   - "Beach house, no plans" -> mozz-pure +2, white-cheese +1
   - "Food tour through Mexico" -> orange-spice +2, mega-spice +1
   - "Skateboarding through European cities" -> cheddar-beddar +2, orange-spice +1
   - "Volcano hiking in Iceland" -> mega-spice +2, mozz-pure +1

4. "How do you take your coffee?" (emoji: coffee)
   - "Oat milk latte, simple" -> white-cheese +2, mozz-pure +1
   - "Black with one sugar" -> cheddar-beddar +2, orange-spice +1
   - "Cold brew with caramel" -> orange-spice +2, white-cheese +1
   - "Espresso shot — make it a triple" -> mega-spice +2, cheddar-beddar +1

5. "What's your go-to party move?" (emoji: party)
   - "Bring a charcuterie board" -> white-cheese +2, cheddar-beddar +1
   - "DJ and never leave the aux" -> orange-spice +2, mozz-pure +1
   - "Challenge everyone to arm wrestling" -> mega-spice +2, cheddar-beddar +1
   - "Find the dog and hang with it all night" -> mozz-pure +2, white-cheese +1

6. "Pick a Tim's Nacho Cheese slogan" (emoji: megaphone)
   - "Keep it real, keep it cheesy" -> white-cheese +2, orange-spice +1
   - "Smooth moves only" -> mozz-pure +2, white-cheese +1
   - "Bold flavors, no apologies" -> cheddar-beddar +2, orange-spice +1
   - "If you can't handle the heat..." -> mega-spice +2, cheddar-beddar +1

7. "Your Vans style?" (emoji: shoe/sneaker)
   - "Classic white slip-ons" -> white-cheese +2, mozz-pure +1
   - "Checkered old skools" -> orange-spice +2, cheddar-beddar +1
   - "Custom painted by a friend" -> mozz-pure +2, cheddar-beddar +1
   - "Whatever survived the last mosh pit" -> mega-spice +2, orange-spice +1

**Quiz Results (one per flavor):**
- white-cheese: "The Classic" -- "You're the chill friend everyone needs. Low-key, reliable, and universally loved. You don't need flash to make an impression."
- orange-spice: "The Signature" -- "You've got that perfect blend of warmth and kick. People gravitate to you because you bring the energy without overdoing it."
- mozz-pure: "The Smooth Operator" -- "Cool, calm, collected. You're the one who makes everything look effortless. Silky smooth vibes only."
- cheddar-beddar: "The Bold One" -- "Sharp, confident, unapologetic. You know what you like and you're not afraid to say it. Respect."
- mega-spice: "The Legend" -- "You live life at 11. Others call you intense, you call it Tuesday. Not everyone can handle your energy — and that's exactly how you like it."

Export: `questions`, `quizResults` (as Record<string, QuizResult>), and all types.
  </action>
  <verify>
Run `bun run check` (or `npm run check`). No TypeScript errors in quiz.ts.
Verify exports are correct: questions array has 7 items, each with 4 answers. quizResults has 5 entries matching flavor IDs.
  </verify>
  <done>
Quiz data model complete with 7 personality questions, 4 answers each with flavor score mappings, and 5 result descriptions matching all flavors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build quiz UI component and quiz route page</name>
  <files>src/lib/components/Quiz.svelte, src/routes/quiz/+page.svelte</files>
  <action>
**Quiz.svelte Component:**

Build an interactive quiz using Svelte 5 runes for ALL state management. Import from quiz.ts and flavors.ts.

State management (all using $state/$derived):
```
let currentQuestion = $state(0);
let scores = $state<Record<string, number>>({
  'white-cheese': 0, 'orange-spice': 0, 'mozz-pure': 0,
  'cheddar-beddar': 0, 'mega-spice': 0
});
let isComplete = $derived(currentQuestion >= questions.length);
let winner = $derived(() => {
  return Object.entries(scores)
    .sort(([,a], [,b]) => b - a)[0][0];
});
```

NOTE on $derived: In Svelte 5, use `$derived(expression)` for simple derivations, or `$derived.by(() => { ... })` for complex ones with multiple statements. The winner calculation needs `$derived.by` since it has a return statement.

Quiz flow with 3 screens:

**Screen 1: Intro**
- Show when currentQuestion === 0 and no answers given yet (use a `started` state flag)
- Fun title: "Which Tim's Cheese Are You?" with cheese emoji
- Subtitle: "Answer 7 totally scientific questions to find your perfect match"
- "Let's Go!" button that sets started = true
- Style: centered, big text, nacho gradient background, bouncySpring scale-in animation

**Screen 2: Questions (currentQuestion 0-6, after started)**
- Progress bar at top: `(currentQuestion + 1) / questions.length` width percentage, bg-nacho-500
- Question number: "Question {currentQuestion + 1} of 7"
- Question emoji (large, centered)
- Question text (font-display, large)
- 4 answer buttons in a 2x2 grid on desktop, stacked on mobile
- Each answer button: white bg, rounded-xl, p-6, hover:bg-nacho-50, border-2 border-transparent hover:border-nacho-300
- Apply `use:cheeseStretch` on each answer button for hover bounce
- On click: add scores from selected answer to running totals, increment currentQuestion

**Transitions between questions:**
- Use bouncySpring for question content: when question changes, spring opacity from 0 to 1 and translateX from 20 to 0 (slide in from right)
- Use `$effect` to reset the transition springs when currentQuestion changes:
  ```
  $effect(() => {
    // Reference currentQuestion to track it
    currentQuestion;
    // Reset springs for new question entrance
    questionOpacity.set(0, { hard: true });
    questionX.set(20, { hard: true });
    // Then animate in
    questionOpacity.set(1);
    questionX.set(0);
  });
  ```

**Screen 3: Result (isComplete)**
- Big reveal animation: cheese emoji scale spring from 0 to 1 with elastic bounce
- "You are..." text fades in
- Result flavor name (from quizResults[winner].title) in large font-display text
- Result emoji (large, animated wobble)
- Result description paragraph
- Result vibe one-liner in italic
- Matching flavor from flavors.ts: show name, tagline, and color treatment
- Two CTA buttons:
  1. "See Your Cheese" -> link to /products (styled with matched flavor's color)
  2. "Try Again" -> resets all state (currentQuestion = 0, started = false, all scores to 0)
- Apply `use:cheeseStretch` on CTA buttons

ALL animations must check prefersReducedMotion() and skip motion if reduced motion is preferred (set springs with { duration: 0 }).

Styling: Use existing Tailwind classes. The quiz wrapper should have a max-w-2xl mx-auto. Use nacho color palette as primary. Each answer button should feel clickable and fun.

**Quiz Route Page (src/routes/quiz/+page.svelte):**

Simple wrapper that imports and renders the Quiz component:
```svelte
<script>
  import Quiz from '$lib/components/Quiz.svelte';
</script>

<div class="max-w-4xl mx-auto">
  <Quiz />
</div>
```

**Navigation update:**
The Nav.svelte already has a `/quiz` link area -- wait, check Nav.svelte links array. It currently has Products, Blog, Merch, About. The quiz is a separate engagement feature, not a main nav item. Instead, add a "Find Your Flavor" CTA link on the homepage (will be there from Plan 01 hero updates) and the products page. Do NOT modify Nav.svelte -- the quiz is discoverable via CTAs on other pages, not the main nav. However, if the quiz route doesn't exist in the nav, that's fine. The route itself just needs to work at /quiz.

Actually, the nav structure should remain as-is. The quiz is a fun feature linked from content pages, not a top-level nav item.
  </action>
  <verify>
Run `bun run build` (or `npm run build`). Build must pass with zero errors.
Run `bun run check` (or `npm run check`). No TypeScript errors.
Start dev server and navigate to /quiz:
- Intro screen shows with "Which Tim's Cheese Are You?" heading
- Clicking "Let's Go!" starts the quiz
- 7 questions display one at a time with progress bar
- Clicking an answer advances to next question with slide animation
- After question 7, result screen shows matched flavor
- "Try Again" resets the quiz
- "See Your Cheese" links to /products
  </verify>
  <done>
Interactive flavor finder quiz complete (BRAND-02). Users can take a 7-question personality quiz that matches them to one of 5 cheese flavors. Quiz has animated transitions, a fun result reveal, and respects reduced motion preferences.
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes with zero errors
2. `bun run check` reports no TypeScript issues
3. Navigate to /quiz -- full quiz flow works (intro -> 7 questions -> result)
4. Progress bar advances correctly with each answer
5. Result correctly identifies a flavor based on answers
6. "Try Again" fully resets the quiz state
7. Animations are smooth between questions
8. With prefers-reduced-motion enabled, quiz transitions are instant
9. Quiz uses Svelte 5 runes throughout ($state, $derived, $effect)
</verification>

<success_criteria>
- BRAND-02 complete: Interactive quiz matches users to their ideal cheese flavor
- 7 fun, on-brand personality questions with 4 answers each
- Score-based matching algorithm correctly identifies best flavor
- Animated transitions between questions and result reveal
- Accessible: respects prefers-reduced-motion
- Clean Svelte 5 runes state management
</success_criteria>

<output>
After completion, create `.planning/phases/03-brand-and-content/03-02-SUMMARY.md`
</output>
