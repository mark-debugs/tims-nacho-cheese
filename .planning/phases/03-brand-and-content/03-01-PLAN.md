---
phase: 03-brand-and-content
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - svelte.config.js
  - src/routes/+page.svelte
  - src/routes/about/+page.svelte
autonomous: true

must_haves:
  truths:
    - "Phase 2 animation infrastructure (bouncySpring, inview, cheeseStretch, prefersReducedMotion) is available and functional"
    - "Homepage displays animated hero with bouncy orange spring animations that trigger on scroll"
    - "Homepage hero has CTA buttons: 'Shop Cheese' linking to /products and 'Find Your Flavor' linking to /quiz"
    - "About page sections animate in as user scrolls down Tim's story"
    - "All new animations respect prefers-reduced-motion"
    - "MDSveX is configured and ready for blog content in Plan 03"
  artifacts:
    - path: "svelte.config.js"
      provides: "MDSveX preprocessor configuration with Shiki syntax highlighting"
      contains: "mdsvex"
    - path: "src/routes/+page.svelte"
      provides: "Animated homepage hero with spring physics"
      min_lines: 80
    - path: "src/routes/about/+page.svelte"
      provides: "Tim's story with scroll-triggered section animations"
      min_lines: 100
  key_links:
    - from: "src/routes/+page.svelte"
      to: "$lib/utils/animations"
      via: "import bouncySpring, prefersReducedMotion"
      pattern: "import.*bouncySpring.*animations"
    - from: "src/routes/+page.svelte"
      to: "$lib/actions/inview"
      via: "use:inview for scroll-triggered hero entrance"
      pattern: "use:inview"
    - from: "src/routes/about/+page.svelte"
      to: "$lib/actions/inview"
      via: "use:inview for scroll-triggered section entrances"
      pattern: "use:inview"
    - from: "svelte.config.js"
      to: "mdsvex"
      via: "preprocess array includes mdsvex"
      pattern: "mdsvex"
---

<objective>
Install Phase 3 dependencies (mdsvex, jsPDF, shiki), configure MDSveX preprocessor, and bring the homepage hero and about page to life with bouncy spring animations using the existing animation infrastructure from Phase 2.

Purpose: Establishes the content pipeline (MDSveX) and delivers the first two visible requirements (HOME-01, BRAND-01) -- the animated hero that makes visitors smile, and Tim's story that draws them in.
Output: Configured MDSveX preprocessor, animated homepage hero, animated about page.
</objective>

<execution_context>
@C:\Users\Mark\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Mark\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-brand-and-content/03-RESEARCH.md

Key existing files to understand:
@src/lib/utils/animations.ts (spring presets, prefersReducedMotion)
@src/lib/actions/inview.ts (scroll-triggered animations)
@src/lib/actions/cheese-stretch.ts (elastic hover effects)
@src/routes/+page.svelte (current homepage - placeholder hero)
@src/routes/about/+page.svelte (current about page - static content)
@svelte.config.js (current config - needs MDSveX added)
@package.json (current deps)
@tailwind.config.js (custom colors and keyframes available)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and configure MDSveX preprocessor</name>
  <files>package.json, svelte.config.js</files>
  <action>
Install Phase 3 dependencies using bun (fall back to npm if bun unavailable):
```bash
bun add -d mdsvex shiki
bun add jspdf
```
Note: Skip @bitmachina/highlighter -- implement the escapeSvelte + Shiki highlighter inline in config (simpler, fewer deps).

Update svelte.config.js to add MDSveX preprocessor:

1. Import mdsvex: `import { mdsvex, escapeSvelte } from 'mdsvex';`
2. Import shiki: `import { createHighlighter } from 'shiki';`
3. Create highlighter instance with theme 'github-dark' and langs ['javascript', 'typescript', 'svelte', 'bash', 'json']
4. Define mdsvex config:
   - extensions: ['.md']
   - highlight.highlighter: async function that uses escapeSvelte + shiki codeToHtml, returns `{@html \`${html}\`}`
5. Update config.extensions to include '.md': `extensions: ['.svelte', '.md']`
6. Update preprocess array: `preprocess: [vitePreprocess(), mdsvex(mdsvexConfig)]`
7. Keep existing adapter config unchanged

IMPORTANT: The shiki createHighlighter is async. Use top-level await in svelte.config.js (ESM module supports this). Follow the pattern from research:
```javascript
const highlighter = await createHighlighter({
  themes: ['github-dark'],
  langs: ['javascript', 'typescript', 'svelte', 'bash', 'json']
});
```

Verify the build still passes after config changes.
  </action>
  <verify>
Run `bun run build` (or `npm run build`). Build must complete successfully with no errors.
Run `bun run check` (or `npm run check`). No new TypeScript errors.
Confirm mdsvex and jspdf appear in package.json.
  </verify>
  <done>
MDSveX preprocessor configured in svelte.config.js with Shiki highlighting. jsPDF installed. Build passes. Ready for markdown content in Plan 03.
  </done>
</task>

<task type="auto">
  <name>Task 2: Animate homepage hero and about page with spring physics</name>
  <files>src/routes/+page.svelte, src/routes/about/+page.svelte</files>
  <action>
PREREQUISITE CHECK: Before starting, verify the Phase 2 animation infrastructure exists and is functional. Confirm these imports resolve:
- `import { bouncySpring, prefersReducedMotion } from '$lib/utils/animations'`
- `import { inview } from '$lib/actions/inview'`
- `import { cheeseStretch } from '$lib/actions/cheese-stretch'`

If any import fails, stop and report the issue.

**Homepage Hero (src/routes/+page.svelte):**

Replace the current static hero with an animated version using existing animation infrastructure. Keep ALL existing content sections (feature cards, featured flavor, social proof, CTA) but enhance them with scroll-triggered animations.

Hero section animations:
- Import `bouncySpring`, `prefersReducedMotion` from `$lib/utils/animations`
- Import `inview` from `$lib/actions/inview`
- Import `cheeseStretch` from `$lib/actions/cheese-stretch`
- Cheese emoji: Use bouncySpring for scale (start at 0, spring to 1 on mount) and a gentle rotation spring (start at -15, spring to 0). Use `$effect` to trigger on mount.
- Title text: Fly in from below using bouncySpring for translateY (start at 40, spring to 0) with slight delay
- Subtitle: Fade in with bouncySpring for opacity (start at 0, spring to 1) with more delay
- CTA buttons: Scale in with bouncySpring (start at 0.8, spring to 1) staggered, apply `use:cheeseStretch` for hover bounce
- Background cheese emojis: Keep the decorative floating elements, enhance with CSS animation variation (different bounce delays)

**Hero CTA buttons must have explicit link destinations:**
- Primary CTA: "Shop Cheese" -> links to `/products`
- Secondary CTA: "Find Your Flavor" -> links to `/quiz`

Use `<a>` tags (not `<button>`) so they are real navigation links. Style the primary as `bg-nacho-500 text-white` and the secondary as `border-2 border-nacho-500 text-nacho-600`.

Feature cards section:
- Wrap each card with `use:inview` action
- On inview, fly cards in from below using bouncySpring for translateY and opacity
- Stagger entrance: card 1 immediate, card 2 +100ms delay, card 3 +200ms delay
- Apply `use:cheeseStretch` on each card for hover bounce effect

Featured Flavor, Social Proof, CTA sections:
- Wrap each section with `use:inview`
- Simple fly-up entrance animation on scroll (translateY spring from 30 to 0, opacity spring from 0 to 1)

ALL animations must check `prefersReducedMotion()` and use `{ duration: 0 }` for instant display if reduced motion is preferred. Follow the exact pattern from Phase 2.

Use Svelte 5 runes throughout: `$state`, `$derived`, `$effect`. Do NOT use old reactive `$:` syntax or `onMount` from svelte lifecycle (use `$effect` instead).

**About Page (src/routes/about/+page.svelte):**

Enhance the existing about page content with scroll-triggered entrance animations. Keep ALL existing content and structure.

- Import same animation utilities (bouncySpring, prefersReducedMotion, inview, cheeseStretch)
- Hero section at top: Cheese emoji scale spring + title fly-up (same pattern as homepage hero)
- "The Origin Story" card: `use:inview` -> fly in from left (translateX spring from -30 to 0)
- "The Philosophy" card: `use:inview` -> fly in from right (translateX spring from 30 to 0)
- Stats grid (4 cards): `use:inview` -> staggered scale-in (scale spring from 0.8 to 1, each +100ms delay)
- "Tim's Essentials" gradient section: `use:inview` -> fly up from below
- Values grid (3 cards): `use:inview` -> staggered fly up
- "Let's Connect" CTA: `use:inview` -> simple fade-in (opacity spring from 0 to 1)
- Apply `use:cheeseStretch` on CTA buttons and interactive cards

**SVELTE 5 EVENT HANDLING FOR INVIEW ACTION:**

The `inview` action (src/lib/actions/inview.ts) dispatches `CustomEvent('inview_enter')` and `CustomEvent('inview_exit')` on the DOM node. In Svelte 5, the `on:` directive is removed. For custom DOM events dispatched by actions, use the `on` prefix as an element attribute (lowercase, no colon):

```svelte
<div use:inview oninview_enter={onSectionInView}
     style="transform: translateY({$sectionY}px); opacity: {$sectionOpacity}">
  <!-- content -->
</div>
```

Do NOT use `on:inview_enter` (old Svelte 4 syntax). Use `oninview_enter` (Svelte 5 syntax).

For each animated section, use this pattern:
```svelte
<script>
  let sectionVisible = $state(false);
  let sectionY = bouncySpring(30);
  let sectionOpacity = bouncySpring(0);

  function onSectionInView() {
    if (sectionVisible) return;
    sectionVisible = true;
    if (prefersReducedMotion()) {
      sectionY.set(0, { duration: 0 });
      sectionOpacity.set(1, { duration: 0 });
    } else {
      sectionY.set(0);
      sectionOpacity.set(1);
    }
  }
</script>

<div use:inview oninview_enter={onSectionInView}
     style="transform: translateY({$sectionY}px); opacity: {$sectionOpacity}">
  <!-- content -->
</div>
```

IMPORTANT: Each animated section needs its OWN set of spring stores. Do NOT share springs across sections or they will animate together. Use descriptive names like `heroScale`, `heroY`, `storyX`, `philosophyX`, `statsScale`, etc.
  </action>
  <verify>
Run `bun run build` (or `npm run build`). Build must pass with zero errors.
Run `bun run check` (or `npm run check`). No TypeScript errors.
Start dev server (`bun run dev` or `npm run dev`) and verify:
- Homepage hero cheese emoji bounces in on load
- Homepage hero text slides up with spring physics
- Homepage hero CTA buttons link correctly: "Shop Cheese" -> /products, "Find Your Flavor" -> /quiz
- Scrolling down triggers feature card entrances (staggered)
- Scrolling triggers remaining sections to animate in
- About page sections animate in on scroll
- All hover effects work (cheeseStretch on buttons/cards)
- No `on:inview_enter` in source -- only `oninview_enter` (Svelte 5 syntax)
  </verify>
  <done>
Homepage displays animated hero with bouncy orange spring animations (HOME-01). Hero CTA buttons link to /products and /quiz. About page tells Tim's story with scroll-triggered section animations (BRAND-01). All animations respect prefers-reduced-motion. Build passes. All event handlers use Svelte 5 syntax (oninview_enter, not on:inview_enter).
  </done>
</task>

</tasks>

<verification>
1. `bun run build` passes with zero errors
2. `bun run check` reports no TypeScript issues
3. Homepage hero animates on load with spring physics (cheese emoji, title, CTA)
4. Homepage hero "Shop Cheese" button links to /products
5. Homepage hero "Find Your Flavor" button links to /quiz
6. Homepage sections animate on scroll (feature cards, featured flavor, stats, CTA)
7. About page sections animate on scroll (story, philosophy, stats, essentials, values, CTA)
8. Hover effects work on interactive elements (cheeseStretch bounce)
9. With prefers-reduced-motion enabled in OS, all animations display instantly without motion
10. MDSveX configured in svelte.config.js and build passes with .md extension support
11. No deprecated `on:` directive syntax -- all custom events use `oninview_enter` format
</verification>

<success_criteria>
- HOME-01 complete: Homepage hero has bouncy spring animations on load
- BRAND-01 complete: About page has scroll-triggered animations throughout
- Hero CTAs link correctly: "Shop Cheese" -> /products, "Find Your Flavor" -> /quiz
- MDSveX preprocessor configured and ready for blog content
- jsPDF installed and ready for recipe card generation
- All animations respect prefers-reduced-motion
- All event handlers use Svelte 5 syntax (no deprecated on: directive)
- Build passes, no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-brand-and-content/03-01-SUMMARY.md`
</output>
